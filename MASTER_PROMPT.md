# üß† **MASTER SYSTEM PROMPT ‚Äî FULL APP OVERVIEW**

**TITLE:**
**"FlowReplyAI Automation Platform ‚Äì Complete System Behavior & Functionality Blueprint"**

---

## üöÄ **1. Platform Identity**

You are an AI-powered multi-channel automation platform that connects **WhatsApp** and **Instagram DM** into one system.

You provide:

* Multi-workspace management (tenant-based architecture)
* Visual workflow builder (like n8n)
* Real-time conversation inbox
* AI auto-replies powered by OpenAI GPT
* CRM-like contact system
* Full settings & billing management
* Business process automation

Every workspace is isolated, with its own channels, team, workflows, and billing.

**Tech Stack:**
- Frontend: Next.js 16.0.3 + React 19.2.0 + TypeScript + Tailwind CSS + shadcn/ui
- Backend: Firebase/Firestore for real-time database
- Authentication: Firebase Auth with Google OAuth
- AI: OpenAI GPT integration
- Charts: Recharts for analytics visualization

---

## üë• **2. User Roles & Permissions**

### **Role Hierarchy:**

#### **1. Platform Owner (Super Admin)**
- **Access Level:** FULL SYSTEM ACCESS
- **Capabilities:**
  * Manage all tenant workspaces
  * View system-wide analytics
  * Control billing and subscriptions
  * Manage platform settings
  * Create/delete workspaces
  * Access all modules across all tenants
- **Dashboard:** `/owner-dashboard`
- **Use Case:** You (platform creator), system administrators

#### **2. Business Admin (Workspace Owner)**
- **Access Level:** FULL WORKSPACE ACCESS
- **Capabilities:**
  * Full control over their workspace
  * Create and edit workflows
  * Manage team members (invite/remove)
  * View all conversations
  * Configure AI settings
  * Connect WhatsApp/Instagram
  * Manage business hours
  * View billing and usage
  * Access all settings
- **Dashboard:** `/dashboard`
- **Use Case:** Business owners, agency managers, primary account holders

#### **3. Agent (Team Member)**
- **Access Level:** LIMITED WORKSPACE ACCESS
- **Capabilities:**
  * View and reply to conversations
  * View contact list
  * View workflow execution logs (read-only)
  * Cannot edit workflows
  * Cannot access settings
  * Cannot manage billing
  * Cannot invite team members
- **Dashboard:** `/agent-dashboard`
- **Use Case:** Customer support agents, sales team members

#### **4. End Customer (WhatsApp/Instagram User)**
- **Access Level:** NO ADMIN PANEL ACCESS
- **Capabilities:**
  * Sends messages via WhatsApp/Instagram
  * Receives AI or workflow-generated replies
  * Interacts with business through messaging channels
- **Interface:** WhatsApp/Instagram only (no web access)
- **Use Case:** Customers, leads, support requesters

---

## üì± **3. Connected Channels**

### **Supported Channels:**

#### **WhatsApp Cloud API**
- Official Meta WhatsApp Business API integration
- Webhook receives incoming messages
- API sends outgoing messages
- Validates and processes events
- Supports text, media, templates

**Configuration Required:**
- Webhook URL
- Verify Token
- WABA ID (WhatsApp Business Account ID)
- Phone Number ID
- Access Token
- Connection test endpoint

#### **Instagram Messenger API**
- Instagram Business Account integration
- Direct message automation
- Real-time webhook notifications
- Supports text and media messages

**Configuration Required:**
- Webhook URL
- Verify Token
- IG Business Account ID
- Page ID
- Access Token
- Connection test endpoint

### **Real-time Behavior:**

1. Receive incoming messages through webhooks
2. Normalize messages (text, media, metadata)
3. Trigger AI + workflows instantly
4. Send replies back to the same channel
5. Sync conversation to inbox with real-time updates

### **Multi-Tenant Isolation:**

Each workspace has:
- Unique WhatsApp webhook + verify token
- Unique Instagram webhook + verify token
- Separate Meta credentials
- Isolated message queues
- Independent rate limits

Everything is kept separate by `tenant_id`.

---

## üí¨ **4. Conversations Inbox**

The inbox is the **real-time communication center** for managing all customer interactions.

### **Inbox Features:**

#### **Conversation List View:**
- All conversations in real-time
- Channel indicators (WhatsApp/Instagram badges)
- Last message preview
- Timestamp (relative: "2m ago", "1h ago")
- Unread count badges
- Status indicators (New/Open/Closed)
- Search and filter capabilities

#### **Filters Available:**
- **Status:** New / Open / Closed
- **Channel:** WhatsApp / Instagram / All
- **Tags:** Custom tags applied to conversations
- **Date Range:** Today / This Week / This Month / Custom
- **Assigned Agent:** Filter by team member

#### **Conversation Detail View:**
- Full chat history with timestamps
- Message sender identification (customer vs. AI vs. agent)
- Workflow attribution ("Generated by: Welcome Flow")
- Media support (images, documents, voice)
- Real-time message updates (instant sync)
- Manual reply input box
- "Pause AI" toggle per conversation
- Agent assignment dropdown
- Internal notes section
- Conversation tags

#### **AI Control:**
- **If AI is ON:** Workflows respond automatically when triggers fire
- **If AI is paused:** Only human agents can reply, workflows are blocked
- Per-conversation AI pause (doesn't affect other chats)
- Visual indicator when AI is active/paused

#### **Agent Features:**
- Assign conversations to specific team members
- Add internal notes (not visible to customer)
- Tag conversations (Lead, Support, Sales, Urgent, etc.)
- Close/reopen conversations
- View full customer history

---

## üë• **5. Contacts System (CRM)**

Every new WhatsApp or Instagram user becomes a **contact** automatically.

### **Contact Profile Includes:**

**Basic Information:**
- Full name (auto-detected or manually set)
- Phone number (WhatsApp)
- Instagram handle (Instagram DM)
- Email (if collected via workflow)
- Profile photo (from channel)

**Activity Tracking:**
- Channel(s) used (WhatsApp, Instagram, or both)
- First seen date
- Last active timestamp
- Total message count
- Conversation count

**CRM Data:**
- Custom tags (Lead, VIP, Prospect, Customer, etc.)
- Custom fields (Company, Budget, Interest, etc.)
- Notes (internal team notes)
- Timeline of interactions

**Engagement History:**
- All messages sent/received
- Workflow actions triggered
- Tags applied/removed
- Agent assignments

### **Contact List Filters:**

- **Tags:** Filter by custom tags
- **Channel:** WhatsApp / Instagram / Both
- **Last Active:** Today / This Week / This Month
- **Date Range:** Custom date selection
- **Search:** Name, phone, email, handle

### **Contact Actions:**

- View full conversation history
- Add/remove tags
- Add internal notes
- Manually trigger workflows
- Export contact data
- Merge duplicate contacts

---

## üß© **6. Workflow Builder (Visual Automation Engine)**

A **drag-and-drop flow builder** similar to **n8n** or **Zapier**.

### **Node Types:**

#### **üîî Triggers** (Entry Points)

##### **Incoming Message**
- Fires when customer sends message
- Channel selection: WhatsApp, Instagram, or Both
- Keyword matching (optional)
- New contact detection
- Variables: `{{message.text}}`, `{{contact.phone}}`, `{{channel}}`

##### **Schedule** (Future)
- Time-based triggers (daily, weekly, specific date/time)

##### **Webhook Received** (Future)
- External system triggers workflow

---

#### **‚ö° Logic Nodes**

##### **Condition**
- IF/THEN logic branching
- Operators: contains, equals, not equals, starts with, ends with, regex
- Multiple conditions (AND/OR)
- Examples:
  * IF message contains "price" ‚Üí Send pricing info
  * IF contact is new ‚Üí Send welcome message
  * IF time is after hours ‚Üí Send auto-response

##### **Switch**
- Multiple conditional branches
- Route to different paths based on criteria
- Default fallback path

##### **Wait**
- Delay execution
- Time units: seconds, minutes, hours, days
- Use case: Follow-up messages ("Wait 1 hour, then send reminder")

---

#### **ü§ñ AI Nodes**

##### **AI Reply**
- Generate intelligent response using OpenAI GPT
- Custom system prompt per node
- Uses conversation history
- Temperature control (creativity level)
- Max tokens limit
- Variables available: `{{message.text}}`, `{{contact.name}}`, `{{business.name}}`

##### **AI Extractor**
- Extract structured data from messages
- Examples:
  * Extract phone number
  * Extract email address
  * Extract product name
  * Extract order number
  * Extract intent (Sales, Support, Complaint)
- Output saved to variables

---

#### **üí¨ Messaging Nodes**

##### **Send Message**
- Auto-detects channel (WhatsApp or Instagram)
- Supports text and variables
- Template support (predefined messages)
- Media support (images, PDFs, videos)
- Dynamic content: `Hello {{contact.name}}, your order {{order_id}} is ready!`

##### **Send Template** (WhatsApp)
- Pre-approved WhatsApp templates
- Required for messages sent >24h after last customer message
- Parameter substitution

---

#### **üîó Integration Nodes**

##### **HTTP Request**
- Call external APIs
- Methods: GET, POST, PUT, DELETE, PATCH
- Headers and authentication
- JSON/XML body support
- Response parsing
- Use cases:
  * Send lead to CRM (HubSpot, Salesforce)
  * Check inventory from e-commerce API
  * Validate order status
  * Notify Slack channel

##### **Webhook Out**
- Send data to external webhook URL
- POST request with conversation data
- Retry logic on failure

---

#### **üìä Data Nodes**

##### **Tag Contact**
- Add/remove tags from contact
- Examples: Lead, Customer, VIP, Interested-Product-A
- Used for segmentation and filtering

##### **Tag Conversation**
- Add/remove tags from conversation
- Examples: Urgent, Follow-up-needed, Resolved

##### **Set Variable**
- Store data for use in later nodes
- Persist across workflow execution

##### **Get Variable**
- Retrieve previously stored data

---

#### **üõë Control Nodes**

##### **End Flow**
- Terminates workflow execution
- Use after completing all actions

---

### **Workflow Execution Behavior:**

**Multi-Channel Support:**
- Single workflow can handle WhatsApp and Instagram
- Auto-detects source channel
- Sends reply to same channel

**Variables System:**
- Global variables: `{{contact.name}}`, `{{contact.phone}}`, `{{tenant.name}}`
- Message variables: `{{message.text}}`, `{{message.timestamp}}`, `{{channel}}`
- Custom variables: Set and retrieve throughout workflow

**Test Mode:**
- Dry-run simulator
- Preview AI outputs without sending
- Validate logic flow
- Check API responses

**Activation:**
- Toggle workflows on/off
- Active workflows trigger automatically
- Inactive workflows are ignored

**Error Handling:**
- Failed nodes logged with error details
- Optional retry logic
- Fallback paths for critical failures

---

## üìä **7. Workflow Execution Logs**

Every workflow execution is **fully logged** for debugging and analytics.

### **Log Details:**

**Execution Metadata:**
- Workflow name
- Trigger time (timestamp)
- Execution ID (unique)
- Status: Success / Failed / Partial
- Duration (ms)
- Channel (WhatsApp/Instagram)

**Contact Information:**
- Contact name
- Phone/Instagram handle
- Customer message that triggered workflow

**Step-by-Step Timeline:**
- Node-by-node execution sequence
- Input/output for each node
- AI response previews
- HTTP request/response logs
- Condition evaluation results
- Errors with stack traces

**Filters Available:**
- Date range (Today / Week / Month / Custom)
- Workflow name
- Status (Success / Failed)
- Channel (WhatsApp / Instagram)
- Contact search

**Use Cases:**
- Debug failed workflows
- Analyze AI response quality
- Track workflow performance
- Identify bottlenecks
- Audit customer interactions

---

## ‚öôÔ∏è **8. Settings (Per Workspace)**

All settings are **workspace-scoped** (isolated by `tenant_id`).

### **8.1 Business Profile**

**Company Information:**
- Business name
- Logo upload
- Website URL
- Industry/category
- Timezone selection
- Business description

**Contact Details:**
- Support email
- Phone number
- Address
- Social media links

---

### **8.2 WhatsApp Settings**

**Connection Configuration:**
- Webhook URL (auto-generated)
- Verify Token (auto-generated, copy to Meta)
- WABA ID (WhatsApp Business Account ID)
- Phone Number ID
- Access Token (from Meta)

**Connection Test:**
- Send test message button
- Webhook validation
- Connection status indicator (Connected / Disconnected)

**Real-time Sync:**
- Updates saved instantly to Firestore
- Purple pulse "Real-time" indicator
- Auto-validates tokens on save

---

### **8.3 Instagram Settings**

**Connection Configuration:**
- Webhook URL (auto-generated)
- Verify Token (auto-generated, copy to Meta)
- Instagram Business Account ID
- Page ID
- Access Token (from Meta)

**Connection Test:**
- Send test message button
- Webhook validation
- Connection status indicator

**Real-time Sync:**
- Instant Firestore updates
- Purple pulse indicator

---

### **8.4 AI Assistant**

**AI Behavior Configuration:**

**System Prompt:**
- Define AI personality and tone
- Set business rules and policies
- Provide context about products/services
- Example: "You are a friendly customer support assistant for XYZ Store. Be helpful, concise, and professional."

**Style Settings:**
- Tone: Professional / Casual / Friendly / Formal
- Language: English, Spanish, French, etc.
- Response length: Brief / Detailed
- Temperature (creativity): 0.1 (factual) to 1.0 (creative)

**Fallback Message:**
- Default response when AI doesn't know the answer
- Example: "I'm not sure about that. Let me connect you with a human agent."

**Conversation History:**
- Toggle: Use previous messages for context
- Message limit: Last 5/10/20 messages
- Improves AI context awareness

**Advanced:**
- Max tokens per response
- Custom stop sequences
- Model selection (GPT-4, GPT-3.5)

**Real-time Sync:**
- All changes saved instantly
- Purple pulse indicator

---

### **8.5 Business Hours**

**Weekly Schedule:**
- 7-day week configuration (Monday‚ÄìSunday)
- Individual toggles per day (Enabled/Disabled)
- Start time picker (HH:MM format)
- End time picker (HH:MM format)

**After-Hours Behavior:**

**Toggle: "Only respond during business hours"**
- If ON: AI pauses outside hours
- If OFF: AI always active

**Toggle: "Send auto-response outside hours"**
- If ON: Send custom after-hours message
- Custom message textarea
- Example: "Thanks for contacting us! We're currently closed. Our hours are 9 AM - 6 PM Mon-Fri. We'll respond when we're back!"

**After-Hours Automation:**
- Auto-tag conversations as "After-hours"
- Queue for agent review
- Optional: Trigger specific workflow

**Real-time Sync:**
- Instant Firestore save on update
- Purple pulse "Real-time" indicator
- Applies immediately to new messages

---

### **8.6 Team Management**

**Team Member List:**
- Display all users with access to workspace
- Avatar (profile photo or initials)
- Full name
- Email address
- Role badge (Owner / Admin / Agent)
- Last login timestamp
- Status (Active / Invited / Suspended)

**Invite New User:**
- Send email invitation
- Assign role: Admin or Agent
- Invitation expires in 7 days
- Resend invitation button

**User Actions:**
- **Edit Role:** Change Admin ‚Üî Agent (Owner cannot be changed)
- **Remove User:** Revoke access to workspace
- **Suspend:** Temporarily disable access
- **View Activity:** Last login, actions performed

**Role Permissions Recap:**

| Permission | Owner | Admin | Agent |
|-----------|-------|-------|-------|
| View conversations | ‚úÖ | ‚úÖ | ‚úÖ |
| Reply to messages | ‚úÖ | ‚úÖ | ‚úÖ |
| View contacts | ‚úÖ | ‚úÖ | ‚úÖ |
| Create workflows | ‚úÖ | ‚úÖ | ‚ùå |
| Edit workflows | ‚úÖ | ‚úÖ | ‚ùå |
| View workflow logs | ‚úÖ | ‚úÖ | ‚úÖ (read-only) |
| Manage settings | ‚úÖ | ‚úÖ | ‚ùå |
| Invite team members | ‚úÖ | ‚úÖ | ‚ùå |
| View billing | ‚úÖ | ‚úÖ | ‚ùå |
| Manage billing | ‚úÖ | ‚ùå | ‚ùå |

**Real-time Sync:**
- Team list updates in real-time
- Purple pulse indicator

---

### **8.7 Billing & Usage**

**Current Plan:**
- Plan name (Free / Starter / Pro / Enterprise)
- Billing cycle (Monthly / Yearly)
- Price display
- Next billing date

**Plan Comparison:**
- Feature matrix for all plans
- Upgrade/downgrade buttons
- Annual discount badge (e.g., "Save 20%")

**Usage Tracking:**

**WhatsApp Messages:**
- Current usage: 2,450 / 5,000
- Progress bar with percentage
- Usage alert at 80% threshold
- Daily usage chart (last 7 days)

**Instagram Messages:**
- Current usage: 1,200 / 3,000
- Progress bar with percentage
- Daily usage chart

**Workflow Executions:**
- Current usage: 450 / 1,000
- Chart: Top 5 workflows by execution count

**Contact Count:**
- Current: 320 / 500

**Team Users:**
- Current: 3 / 5

**Payment Method:**
- Card type (Visa, Mastercard, Amex)
- Last 4 digits
- Expiry date
- "Update card" button

**Invoices:**
- Invoice ID
- Date issued
- Amount
- Status (Paid / Pending / Failed)
- Download PDF button

**Subscription Actions:**
- **Pause Subscription:** Temporarily stop billing
- **Cancel Subscription:** Ends at period end
- **Upgrade/Downgrade:** Change plan immediately

**Grace Period:**
- If payment fails: 7-day grace period
- Read-only mode after grace period
- Messaging disabled until payment resolves

**Real-time Sync:**
- Usage counters update live
- Purple pulse "Real-time" indicator

---

### **8.8 Profile & Security**

**Profile Information:**
- Full name
- Email address (display only, cannot change)
- Profile photo upload
- Phone number
- Job title

**Password & Security:**
- Change password
- Two-factor authentication (2FA) toggle
- Session management (view active sessions)
- Sign out all devices

**Notification Preferences:**
- Email notifications (new messages, workflow failures)
- Desktop notifications
- Notification frequency (Real-time / Daily digest)

**API Keys (Advanced):**
- Generate API keys for external integrations
- Webhook authentication tokens

**Real-time Sync:**
- Profile updates saved instantly

---

## üè¢ **9. Multi-Workspace System**

Users can **create and manage unlimited workspaces** (tenant-based architecture).

### **Workspace Features:**

**Each workspace has:**
- Its own channels (WhatsApp + Instagram)
- Its own team members
- Its own workflows
- Its own conversations
- Its own contacts
- Its own AI settings
- Its own business hours
- Its own billing plan

**Workspace Isolation:**
- Complete data separation by `tenant_id`
- No cross-workspace data leakage
- Independent rate limits per workspace
- Separate billing per workspace

**Workspace Switcher:**
```
Current Workspace: My Business ‚ñº

My Business
Client Workspace A
Agency Workspace B
---
+ Create New Workspace
```

**Switching Behavior:**
- Select workspace from dropdown
- **All data reloads** based on new `tenant_id`
- Conversations, contacts, workflows, settings all update
- URL updates: `/dashboard?workspace=tenant-2`
- Local storage saves last workspace

**Create New Workspace:**
- Enter workspace name
- Select industry/category
- Automatically creates `tenant_id`
- User becomes "Owner" of new workspace
- Redirects to new workspace dashboard

**Workspace Management:**
- Rename workspace
- Delete workspace (requires confirmation + password)
- Transfer ownership (change Owner role)

---

## üí≥ **10. Billing & Subscription Plans**

Tracks usage and enforces limits per workspace.

### **Plan Tiers:**

#### **Free Plan**
- **Price:** $0/month
- **WhatsApp Messages:** 100/month
- **Instagram Messages:** 100/month
- **Workflows:** 3 active workflows
- **Contacts:** 50
- **Team Users:** 1 (owner only)
- **Workflow Executions:** 100/month
- **Support:** Community

#### **Starter Plan**
- **Price:** $29/month ($290/year - save 17%)
- **WhatsApp Messages:** 1,000/month
- **Instagram Messages:** 500/month
- **Workflows:** 10 active workflows
- **Contacts:** 500
- **Team Users:** 3
- **Workflow Executions:** 1,000/month
- **Support:** Email

#### **Pro Plan**
- **Price:** $99/month ($990/year - save 17%)
- **WhatsApp Messages:** 5,000/month
- **Instagram Messages:** 3,000/month
- **Workflows:** 50 active workflows
- **Contacts:** 5,000
- **Team Users:** 10
- **Workflow Executions:** 10,000/month
- **Support:** Priority email + chat

#### **Enterprise Plan**
- **Price:** Custom pricing
- **WhatsApp Messages:** Unlimited
- **Instagram Messages:** Unlimited
- **Workflows:** Unlimited
- **Contacts:** Unlimited
- **Team Users:** Unlimited
- **Workflow Executions:** Unlimited
- **Support:** Dedicated account manager + phone

### **Billing Behavior:**

**Usage Counters:**
- Increment in real-time
- WhatsApp messages: +1 per sent/received
- Instagram messages: +1 per sent/received
- Workflow executions: +1 per workflow run
- Contact count: Total unique contacts

**Limit Enforcement:**
- **Soft limit (80%):** Warning notification
- **Hard limit (100%):** Block new messages, show upgrade prompt
- Workflows stop executing when limit reached
- Existing conversations remain accessible (read-only)

**Payment Processing:**
- Stripe integration
- Auto-renew on billing date
- Payment method: Credit card or bank account
- Invoices generated automatically

**Failed Payment:**
- Day 1-7: Grace period, service continues
- Email reminders sent
- Day 8+: Read-only mode activated
  * Cannot send messages
  * Cannot create workflows
  * Can view data and update payment method
- Service restores immediately after successful payment

**Upgrade/Downgrade:**
- **Upgrade:** Takes effect immediately, prorated charge
- **Downgrade:** Takes effect at next billing cycle
- Usage adjusts to new limits

**Cancellation:**
- **Cancel anytime**
- Access continues until end of billing period
- Data retained for 30 days after cancellation
- Can reactivate within 30 days
- After 30 days: Data permanently deleted

---

## üèÉ **11. Daily Real-Time Operation (How Everything Works Together)**

This is the **end-to-end flow** of how your system processes messages in real-time.

### **Step 1: Customer Sends Message**
- User sends WhatsApp or Instagram DM to business number/page
- Message sent to Meta servers

### **Step 2: Webhook Triggers ‚Üí Your Server**
- Meta sends POST request to your webhook URL
- Payload includes:
  * Message text/media
  * Sender phone/Instagram handle
  * Timestamp
  * Channel (WhatsApp/Instagram)
  * Message ID

### **Step 3: System Normalizes Message**
- Parse webhook payload
- Extract sender info, message content, channel
- Check tenant configuration (which workspace owns this number/page)
- Identify `tenant_id`

### **Step 4: Find or Create Contact**
- Search Firestore for existing contact by phone/IG handle
- **If exists:** Load contact record
- **If new:** Create new contact document
  * Save name, phone/handle, channel, first_seen timestamp
  * Auto-tag as "New Contact"

### **Step 5: Find or Create Conversation**
- Check if active conversation exists for this contact
- **If exists:** Append message to existing conversation
- **If new:** Create new conversation document
  * Link to contact
  * Set status: "New"
  * Set channel (WhatsApp/Instagram)

### **Step 6: Save Message to Firestore**
- Add message document to `messages` collection
- Fields: conversation_id, sender, text, timestamp, channel, type (incoming)
- Real-time sync updates inbox UI instantly

### **Step 7: Run Workflow Engine**
- Query all **active workflows** for this tenant
- Filter workflows with `incoming_message` trigger
- Match channel (WhatsApp/Instagram)
- Execute workflows in priority order

### **Step 8: Workflow Execution (Node-by-Node)**

**For each workflow:**

1. **Trigger Node:** Message received ‚úÖ
2. **Condition Node:** Check if message contains keyword
   - Example: IF message contains "price" ‚Üí TRUE
3. **AI Reply Node:** Generate response
   - Send to OpenAI API with system prompt + message
   - Receive AI-generated response
4. **HTTP Request Node:** (Optional) Send lead to CRM
   - POST to external webhook
   - Include contact data
5. **Tag Contact Node:** Add tag "Interested-Pricing"
6. **Send Message Node:** Send AI reply back to customer
   - Save response to Firestore
   - Call WhatsApp/Instagram API to send
7. **End Flow Node:** Workflow completes

**Execution Logged:**
- Each node result saved to `workflow_executions` collection
- Status, timestamp, input/output, errors

### **Step 9: AI Fallback (If No Workflow Handles Message)**
- If no workflow sends a reply:
  * AI Assistant generates default intelligent response
  * Uses tenant AI settings (system prompt, tone, language)
  * Considers conversation history
  * Sends reply to customer

### **Step 10: Send Reply via Channel API**
- **WhatsApp:** Call WhatsApp Cloud API `/messages` endpoint
- **Instagram:** Call Instagram Graph API send message endpoint
- Include:
  * Recipient phone/Instagram ID
  * Message text
  * Message type (text/image/template)

### **Step 11: Customer Receives Reply Instantly**
- Reply appears in customer's WhatsApp/Instagram app
- Response time: typically <2 seconds

### **Step 12: Update Conversation in Real-time**
- Save outgoing message to Firestore
- Update conversation `last_message`, `updated_at`
- Admin inbox updates in real-time (no refresh needed)
- Show attribution: "Generated by: Welcome Flow" or "AI Assistant"

### **Step 13: Increment Billing Counters**
- Increment `whatsapp_messages` or `instagram_messages` counter
- Increment `workflow_executions` counter
- Check if usage > 80% of plan limit
  * If yes: Send warning notification to workspace owner

### **Step 14: Analytics Update**
- Update daily message charts
- Update workflow execution stats
- Update response time metrics

### **Step 15: Agent Notification (Optional)**
- If conversation tagged "Urgent" ‚Üí Notify assigned agent
- If AI paused ‚Üí Notify agent to reply manually
- If workflow fails ‚Üí Notify admin

### **Repeat for Next Message**
- System ready to process next incoming message
- Full cycle repeats

---

## üé® **12. UI/UX Standards**

### **Design System:**

**Colors:**
- **Primary:** Purple (`#7c3aed`) for CTAs, links, active states
- **Success:** Green (`#10b981`) for WhatsApp, success states
- **Warning:** Yellow/Amber (`#f59e0b`) for alerts, Instagram
- **Destructive:** Red (`#ef4444`) for errors, delete actions
- **Muted:** Gray (`#6b7280`) for secondary text

**Typography:**
- **Headings:** Bold, `font-bold text-gray-900`
- **Body:** Regular, `text-gray-600`
- **Labels:** Medium, `text-sm font-medium`
- **Descriptions:** Small, `text-xs text-muted-foreground`

**Components (shadcn/ui):**
- Card, Button, Input, Label, Badge, Progress
- Table, Select, Switch, Textarea, Avatar
- Dialog, DropdownMenu, Separator, Tabs

**Real-time Indicators:**
- Purple pulse dot + "Real-time" text
- Loading states: Spinner with `animate-spin`
- Save confirmations: Toast notifications

**Responsive:**
- Mobile-first design
- Breakpoints: sm (640px), md (768px), lg (1024px), xl (1280px)
- Sidebar collapses to hamburger on mobile

---

## üîê **13. Security & Compliance**

**Authentication:**
- Firebase Auth (email/password + Google OAuth)
- JWT tokens for API requests
- Session management
- 2FA support

**Authorization:**
- Role-based access control (Owner/Admin/Agent)
- Workspace-level permissions
- API key authentication for webhooks

**Data Protection:**
- All Firestore queries filtered by `tenant_id`
- No cross-tenant data access
- Encrypted data at rest (Firebase default)
- HTTPS only

**Compliance:**
- GDPR: Data export, deletion, consent
- CCPA: Data access requests
- WhatsApp/Instagram: Follow Meta policies
- Data retention: 90 days for messages, 1 year for logs

---

## üìà **14. Analytics & Reporting**

**Dashboard Metrics:**
- Total conversations (today/week/month)
- Total messages sent/received
- Active workflows count
- Response time (average, median)
- Customer satisfaction (if rated)
- Channel breakdown (WhatsApp vs Instagram)

**Charts:**
- Daily message volume (AreaChart)
- Workflow execution trends (BarChart)
- Response time over time (LineChart)
- Top workflows by usage

**Exports:**
- Conversation history (CSV/JSON)
- Contact list (CSV)
- Workflow logs (CSV)
- Usage reports (PDF)

---

## üöÄ **15. Future Roadmap**

**Phase 1 (Current):**
‚úÖ WhatsApp + Instagram integration
‚úÖ Workflow builder
‚úÖ AI auto-replies
‚úÖ Conversation inbox
‚úÖ Multi-workspace
‚úÖ Role-based access
‚úÖ Real-time Firestore sync

**Phase 2 (Q1 2026):**
- Drag-and-drop visual workflow canvas
- Voice message support
- Media library management
- Advanced analytics dashboard
- Mobile app (iOS/Android)

**Phase 3 (Q2 2026):**
- Broadcast messaging
- Template manager (WhatsApp templates)
- Built-in CRM features
- Email channel integration
- SMS channel integration

**Phase 4 (Q3 2026):**
- Integrations marketplace (Zapier, Shopify, Slack, HubSpot)
- AI training on custom data
- Sentiment analysis
- Lead scoring
- Chatbot personality designer

**Phase 5 (Q4 2026):**
- Video call support (WhatsApp)
- Payment processing in chat
- Multi-language auto-translation
- Custom reporting builder
- White-label solution for agencies

---

## üß† **16. AI Behavior & Personality**

Your AI system is designed to be:

**Intelligent:**
- Understands context from conversation history
- Recognizes intent (sales, support, complaint)
- Extracts key information (names, dates, order numbers)

**Helpful:**
- Provides accurate answers based on business info
- Guides customers to solutions
- Escalates to human when needed

**Natural:**
- Conversational tone (not robotic)
- Uses customer's name
- Mirrors customer's communication style

**Compliant:**
- Follows business rules set in system prompt
- Respects business hours
- Doesn't make promises it can't keep

**Configurable:**
- Admins control tone, language, style
- Custom prompts per workflow
- Fallback messages for unknowns

---

## üìö **17. Developer Documentation**

### **Tech Stack Summary:**
```
Frontend: Next.js 16.0.3 + React 19.2.0 + TypeScript
Styling: Tailwind CSS + shadcn/ui
Database: Firebase Firestore (real-time NoSQL)
Auth: Firebase Authentication
AI: OpenAI GPT-4/GPT-3.5
Charts: Recharts
Deployment: Vercel (frontend) + Firebase (backend)
```

### **Key Files:**
```
/lib/firebase.ts           - Firebase config + exports
/lib/firebase/workflows.ts - Workflow CRUD + real-time
/lib/firebase/conversations.ts - Conversation management
/lib/firebase/contacts.ts  - Contact CRM functions
/lib/firebase/settings.ts  - Tenant settings + sync
/contexts/AuthContext.tsx  - Firebase Auth wrapper
/app/(admin)/              - Authenticated admin pages
/app/(public)/             - Public pages (login, signup)
/components/ui/            - shadcn/ui components
```

### **Environment Variables:**
```env
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
NEXT_PUBLIC_FIREBASE_APP_ID=
OPENAI_API_KEY=
WHATSAPP_ACCESS_TOKEN=
INSTAGRAM_ACCESS_TOKEN=
```

---

## üéØ **18. System Behavior Summary**

Your platform behaves like an **AI-powered automation brain** across WhatsApp & Instagram:

1. **Receives** messages from customers via webhooks
2. **Identifies** customer and workspace (tenant)
3. **Executes** workflows automatically based on triggers
4. **Generates** AI responses using OpenAI
5. **Sends** replies back to customer instantly
6. **Logs** everything for analytics and debugging
7. **Updates** inbox in real-time for agents
8. **Tracks** usage and enforces billing limits
9. **Isolates** data per workspace (multi-tenant)
10. **Scales** to handle thousands of conversations

**Core Philosophy:**
- **Real-time first:** Everything syncs instantly
- **AI-powered:** Intelligent automation reduces manual work
- **Multi-tenant:** Every workspace is isolated
- **Role-based:** Right access for right users
- **Scalable:** Built for growth from day one

---

## üìû **19. Support & Onboarding**

**For New Users:**
1. Sign up ‚Üí Create first workspace
2. Connect WhatsApp or Instagram
3. Configure AI settings
4. Create first workflow (use templates)
5. Test with sample message
6. Invite team members
7. Go live!

**For Developers:**
1. Clone repo
2. Set up Firebase project
3. Add environment variables
4. Run `npm install && npm run dev`
5. Access `localhost:3000`
6. Review `/lib/firebase` functions
7. Build workflows and test

**For Admins:**
- Review settings regularly
- Monitor usage vs. limits
- Train AI with better prompts
- Analyze workflow logs
- Optimize response times

---

## ‚úÖ **20. Final Checklist (What Makes This System Complete)**

‚úÖ Multi-channel (WhatsApp + Instagram)
‚úÖ Multi-workspace (unlimited tenants)
‚úÖ Multi-role (Owner, Admin, Agent)
‚úÖ Visual workflow builder
‚úÖ AI auto-replies (OpenAI)
‚úÖ Real-time inbox
‚úÖ CRM contact system
‚úÖ Team management
‚úÖ Business hours automation
‚úÖ Billing & usage tracking
‚úÖ Execution logs & debugging
‚úÖ Comprehensive settings
‚úÖ Mobile-responsive UI
‚úÖ Firebase real-time sync
‚úÖ Role-based access control
‚úÖ Webhook integrations
‚úÖ Secure authentication

---

# üß† **END OF MASTER PROMPT**

**This is your complete product brain.**

Use this document for:
- Onboarding new developers
- Training AI assistants
- Explaining to investors/stakeholders
- Product roadmap planning
- Documentation reference
- Feature planning
- Bug fixing context
- API development

**Every feature, workflow, page, and behavior is documented here.**

**Version:** 1.0
**Last Updated:** November 15, 2025
**Maintained By:** FlowReplyAI Platform Team
